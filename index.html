<script>
    const DB_NAME = 'progressDB';
    const DB_VERSION = 1;
    let db;

    // Funkcja do otwierania/tworzenia bazy danych
    function openDatabase() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(DB_NAME, DB_VERSION);

            request.onupgradeneeded = (event) => {
                db = event.target.result;
                const objectStore = db.createObjectStore('entries', { keyPath: 'id', autoIncrement: true });
                // Tworzenie indeksów, aby wyszukiwanie było szybsze
                objectStore.createIndex('data', 'data', { unique: false });
            };

            request.onsuccess = (event) => {
                db = event.target.result;
                resolve(db);
            };

            request.onerror = (event) => {
                console.error("IndexedDB error:", event.target.errorCode);
                reject("Database error");
            };
        });
    }

    // Funkcja do zapisywania danych w bazie
    async function zapiszDane() {
        const data = document.getElementById('data').value;
        const waga = parseFloat(document.getElementById('waga').value);
        const wzrost = parseFloat(document.getElementById('wzrost').value);
        const klata = parseFloat(document.getElementById('klata').value);
        const klataSkos = parseFloat(document.getElementById('klata-skos').value);
        const martwyCiag = parseFloat(document.getElementById('martwy-ciag').value);
        const bicepsUg = parseFloat(document.getElementById('biceps-ug').value);
        const bicepsObw = parseFloat(document.getElementById('biceps-obw').value);

        if (data && !isNaN(waga) && !isNaN(wzrost) && !isNaN(klata) && !isNaN(klataSkos) && !isNaN(martwyCiag) && !isNaN(bicepsUg) && !isNaN(bicepsObw)) {
            const nowyWpis = { data, waga, wzrost, klata, klataSkos, martwyCiag, bicepsUg, bicepsObw };
            
            try {
                const db = await openDatabase();
                const transaction = db.transaction(['entries'], 'readwrite');
                const objectStore = transaction.objectStore('entries');
                const request = objectStore.add(nowyWpis);

                request.onsuccess = () => {
                    alert('Dane zostały zapisane!');
                    document.getElementById('data').value = '';
                    document.getElementById('waga').value = '';
                    document.getElementById('wzrost').value = '';
                    document.getElementById('klata').value = '';
                    document.getElementById('klata-skos').value = '';
                    document.getElementById('martwy-ciag').value = '';
                    document.getElementById('biceps-ug').value = '';
                    document.getElementById('biceps-obw').value = '';
                };
                request.onerror = (event) => {
                    console.error("Add request error:", event.target.error);
                    alert("Wystąpił błąd podczas zapisywania danych.");
                };
            } catch (error) {
                console.error("Database operation error:", error);
            }
        } else {
            alert("Wypełnij wszystkie pola poprawnymi wartościami!");
        }
    }
</script>